function cov_ts6n1zz9b() {
  var path = "D:\\! At Work\\5OpenSource\\svg-path-commander\\src\\process\\transformEllipse.js";
  var hash = "386bccd74b62d471ebc9b6dfe6a6eec4d61b54c0";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "D:\\! At Work\\5OpenSource\\svg-path-commander\\src\\process\\transformEllipse.js",
    statementMap: {
      "0": {
        start: {
          line: 15,
          column: 12
        },
        end: {
          line: 15,
          column: 42
        }
      },
      "1": {
        start: {
          line: 16,
          column: 12
        },
        end: {
          line: 16,
          column: 42
        }
      },
      "2": {
        start: {
          line: 17,
          column: 13
        },
        end: {
          line: 22,
          column: 3
        }
      },
      "3": {
        start: {
          line: 27,
          column: 12
        },
        end: {
          line: 27,
          column: 41
        }
      },
      "4": {
        start: {
          line: 28,
          column: 12
        },
        end: {
          line: 28,
          column: 41
        }
      },
      "5": {
        start: {
          line: 31,
          column: 10
        },
        end: {
          line: 32,
          column: 83
        }
      },
      "6": {
        start: {
          line: 35,
          column: 13
        },
        end: {
          line: 35,
          column: 24
        }
      },
      "7": {
        start: {
          line: 38,
          column: 2
        },
        end: {
          line: 43,
          column: 3
        }
      },
      "8": {
        start: {
          line: 40,
          column: 16
        },
        end: {
          line: 40,
          column: 29
        }
      },
      "9": {
        start: {
          line: 42,
          column: 4
        },
        end: {
          line: 42,
          column: 39
        }
      },
      "10": {
        start: {
          line: 46,
          column: 12
        },
        end: {
          line: 46,
          column: 41
        }
      },
      "11": {
        start: {
          line: 48,
          column: 2
        },
        end: {
          line: 48,
          column: 19
        }
      },
      "12": {
        start: {
          line: 51,
          column: 13
        },
        end: {
          line: 51,
          column: 23
        }
      },
      "13": {
        start: {
          line: 52,
          column: 13
        },
        end: {
          line: 52,
          column: 23
        }
      },
      "14": {
        start: {
          line: 54,
          column: 11
        },
        end: {
          line: 56,
          column: 41
        }
      },
      "15": {
        start: {
          line: 61,
          column: 2
        },
        end: {
          line: 70,
          column: 3
        }
      },
      "16": {
        start: {
          line: 63,
          column: 4
        },
        end: {
          line: 63,
          column: 23
        }
      },
      "17": {
        start: {
          line: 64,
          column: 4
        },
        end: {
          line: 64,
          column: 23
        }
      },
      "18": {
        start: {
          line: 67,
          column: 4
        },
        end: {
          line: 67,
          column: 13
        }
      },
      "19": {
        start: {
          line: 68,
          column: 4
        },
        end: {
          line: 68,
          column: 23
        }
      },
      "20": {
        start: {
          line: 69,
          column: 4
        },
        end: {
          line: 69,
          column: 23
        }
      },
      "21": {
        start: {
          line: 72,
          column: 2
        },
        end: {
          line: 72,
          column: 36
        }
      }
    },
    fnMap: {
      "0": {
        name: "transformEllipse",
        decl: {
          start: {
            line: 11,
            column: 24
          },
          end: {
            line: 11,
            column: 40
          }
        },
        loc: {
          start: {
            line: 11,
            column: 56
          },
          end: {
            line: 73,
            column: 1
          }
        },
        line: 11
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 38,
            column: 2
          },
          end: {
            line: 43,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 38,
            column: 2
          },
          end: {
            line: 43,
            column: 3
          }
        }, {
          start: {
            line: 38,
            column: 2
          },
          end: {
            line: 43,
            column: 3
          }
        }],
        line: 38
      },
      "1": {
        loc: {
          start: {
            line: 54,
            column: 11
          },
          end: {
            line: 56,
            column: 41
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 54,
            column: 67
          },
          end: {
            line: 54,
            column: 69
          }
        }, {
          start: {
            line: 55,
            column: 6
          },
          end: {
            line: 56,
            column: 41
          }
        }],
        line: 54
      },
      "2": {
        loc: {
          start: {
            line: 54,
            column: 12
          },
          end: {
            line: 54,
            column: 63
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 54,
            column: 12
          },
          end: {
            line: 54,
            column: 33
          }
        }, {
          start: {
            line: 54,
            column: 37
          },
          end: {
            line: 54,
            column: 63
          }
        }],
        line: 54
      },
      "3": {
        loc: {
          start: {
            line: 55,
            column: 16
          },
          end: {
            line: 56,
            column: 30
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 55,
            column: 49
          },
          end: {
            line: 55,
            column: 61
          }
        }, {
          start: {
            line: 56,
            column: 8
          },
          end: {
            line: 56,
            column: 30
          }
        }],
        line: 55
      },
      "4": {
        loc: {
          start: {
            line: 61,
            column: 2
          },
          end: {
            line: 70,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 61,
            column: 2
          },
          end: {
            line: 70,
            column: 3
          }
        }, {
          start: {
            line: 61,
            column: 2
          },
          end: {
            line: 70,
            column: 3
          }
        }],
        line: 61
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0
    },
    f: {
      "0": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0]
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "386bccd74b62d471ebc9b6dfe6a6eec4d61b54c0"
  };
  var coverage = global[gcv] || (global[gcv] = {});

  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }

  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_ts6n1zz9b = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}

cov_ts6n1zz9b();
import epsilon from '../math/epsilon';
/**
 * Apply a 2D transformation matrix to an ellipse.
 *
 * @param {number[]} m the 2D transformation matrix
 * @param {number} rx ellipse radius X
 * @param {number} ry ellipse radius Y
 * @param {number} ax ellipse rotation angle
 */

export default function transformEllipse(m, rx, ry, ax) {
  cov_ts6n1zz9b().f[0]++;
  // We consider the current ellipse as image of the unit circle
  // by first scale(rx,ry) and then rotate(ax) ...
  // So we apply ma =  m x rotate(ax) x scale(rx,ry) to the unit circle.
  const c = (cov_ts6n1zz9b().s[0]++, Math.cos(ax * Math.PI / 180));
  const s = (cov_ts6n1zz9b().s[1]++, Math.sin(ax * Math.PI / 180));
  const ma = (cov_ts6n1zz9b().s[2]++, [rx * (m[0] * c + m[2] * s), rx * (m[1] * c + m[3] * s), ry * (-m[0] * s + m[2] * c), ry * (-m[1] * s + m[3] * c)]); // ma * transpose(ma) = [ J L ]
  //                      [ L K ]
  // L is calculated later (if the image is not a circle)

  const J = (cov_ts6n1zz9b().s[3]++, ma[0] * ma[0] + ma[2] * ma[2]);
  const K = (cov_ts6n1zz9b().s[4]++, ma[1] * ma[1] + ma[3] * ma[3]); // the discriminant of the characteristic polynomial of ma * transpose(ma)

  let D = (cov_ts6n1zz9b().s[5]++, ((ma[0] - ma[3]) * (ma[0] - ma[3]) + (ma[2] + ma[1]) * (ma[2] + ma[1])) * ((ma[0] + ma[3]) * (ma[0] + ma[3]) + (ma[2] - ma[1]) * (ma[2] - ma[1]))); // the "mean eigenvalue"

  const JK = (cov_ts6n1zz9b().s[6]++, (J + K) / 2); // check if the image is (almost) a circle

  cov_ts6n1zz9b().s[7]++;

  if (D < epsilon * JK) {
    cov_ts6n1zz9b().b[0][0]++;
    // if it is
    const rxy = (cov_ts6n1zz9b().s[8]++, Math.sqrt(JK));
    cov_ts6n1zz9b().s[9]++;
    return {
      rx: rxy,
      ry: rxy,
      ax: 0
    };
  } else {
    cov_ts6n1zz9b().b[0][1]++;
  } // if it is not a circle


  const L = (cov_ts6n1zz9b().s[10]++, ma[0] * ma[1] + ma[2] * ma[3]);
  cov_ts6n1zz9b().s[11]++;
  D = Math.sqrt(D); // {l1,l2} = the two eigen values of ma * transpose(ma)

  const l1 = (cov_ts6n1zz9b().s[12]++, JK + D / 2);
  const l2 = (cov_ts6n1zz9b().s[13]++, JK - D / 2); // the x - axis - rotation angle is the argument of the l1 - eigenvector

  let AX = (cov_ts6n1zz9b().s[14]++, (cov_ts6n1zz9b().b[2][0]++, Math.abs(L) < epsilon) && (cov_ts6n1zz9b().b[2][1]++, Math.abs(l1 - K) < epsilon) ? (cov_ts6n1zz9b().b[1][0]++, 90) : (cov_ts6n1zz9b().b[1][1]++, Math.atan(Math.abs(L) > Math.abs(l1 - K) ? (cov_ts6n1zz9b().b[3][0]++, (l1 - J) / L) : (cov_ts6n1zz9b().b[3][1]++, L / (l1 - K) * 180)) / Math.PI));
  let RX;
  let RY; // if ax > 0 => rx = sqrt(l1), ry = sqrt(l2), else exchange axes and ax += 90

  cov_ts6n1zz9b().s[15]++;

  if (AX >= 0) {
    cov_ts6n1zz9b().b[4][0]++;
    cov_ts6n1zz9b().s[16]++;
    // if ax in [0,90]
    RX = Math.sqrt(l1);
    cov_ts6n1zz9b().s[17]++;
    RY = Math.sqrt(l2);
  } else {
    cov_ts6n1zz9b().b[4][1]++;
    cov_ts6n1zz9b().s[18]++;
    // if ax in ]-90,0[ => exchange axes
    AX += 90;
    cov_ts6n1zz9b().s[19]++;
    RX = Math.sqrt(l2);
    cov_ts6n1zz9b().s[20]++;
    RY = Math.sqrt(l1);
  }

  cov_ts6n1zz9b().s[21]++;
  return {
    rx: RX,
    ry: RY,
    ax: AX
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRyYW5zZm9ybUVsbGlwc2UuanMiXSwibmFtZXMiOlsiZXBzaWxvbiIsInRyYW5zZm9ybUVsbGlwc2UiLCJtIiwicngiLCJyeSIsImF4IiwiYyIsIk1hdGgiLCJjb3MiLCJQSSIsInMiLCJzaW4iLCJtYSIsIkoiLCJLIiwiRCIsIkpLIiwicnh5Iiwic3FydCIsIkwiLCJsMSIsImwyIiwiQVgiLCJhYnMiLCJhdGFuIiwiUlgiLCJSWSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFlWTs7Ozs7Ozs7O0FBZlosT0FBT0EsT0FBUCxNQUFvQixpQkFBcEI7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUNBLGVBQWUsU0FBU0MsZ0JBQVQsQ0FBMEJDLENBQTFCLEVBQTZCQyxFQUE3QixFQUFpQ0MsRUFBakMsRUFBcUNDLEVBQXJDLEVBQXlDO0FBQUE7QUFDdEQ7QUFDQTtBQUNBO0FBQ0EsUUFBTUMsQ0FBQyw0QkFBR0Ms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QUksRUFBTjtBQUZLO0FBR0xHLElBQUFBLEVBQUUsR0FBR2xCLElBQUksQ0FBQ1csSUFBTCxDQUFVRyxFQUFWLENBQUw7QUFISztBQUlMSyxJQUFBQSxFQUFFLEdBQUduQixJQUFJLENBQUNXLElBQUwsQ0FBVUUsRUFBVixDQUFMO0FBQ0Q7O0FBM0RxRDtBQTZEdEQsU0FBTztBQUFFakIsSUFBQUEsRUFBRSxFQUFFc0IsRUFBTjtBQUFVckIsSUFBQUEsRUFBRSxFQUFFc0IsRUFBZDtBQUFrQnJCLElBQUFBLEVBQUUsRUFBRWlCO0FBQXRCLEdBQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBlcHNpbG9uIGZyb20gJy4uL21hdGgvZXBzaWxvbic7XG5cbi8qKlxuICogQXBwbHkgYSAyRCB0cmFuc2Zvcm1hdGlvbiBtYXRyaXggdG8gYW4gZWxsaXBzZS5cbiAqXG4gKiBAcGFyYW0ge251bWJlcltdfSBtIHRoZSAyRCB0cmFuc2Zvcm1hdGlvbiBtYXRyaXhcbiAqIEBwYXJhbSB7bnVtYmVyfSByeCBlbGxpcHNlIHJhZGl1cyBYXG4gKiBAcGFyYW0ge251bWJlcn0gcnkgZWxsaXBzZSByYWRpdXMgWVxuICogQHBhcmFtIHtudW1iZXJ9IGF4IGVsbGlwc2Ugcm90YXRpb24gYW5nbGVcbiAqL1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gdHJhbnNmb3JtRWxsaXBzZShtLCByeCwgcnksIGF4KSB7XG4gIC8vIFdlIGNvbnNpZGVyIHRoZSBjdXJyZW50IGVsbGlwc2UgYXMgaW1hZ2Ugb2YgdGhlIHVuaXQgY2lyY2xlXG4gIC8vIGJ5IGZpcnN0IHNjYWxlKHJ4LHJ5KSBhbmQgdGhlbiByb3RhdGUoYXgpIC4uLlxuICAvLyBTbyB3ZSBhcHBseSBtYSA9ICBtIHggcm90YXRlKGF4KSB4IHNjYWxlKHJ4LHJ5KSB0byB0aGUgdW5pdCBjaXJjbGUuXG4gIGNvbnN0IGMgPSBNYXRoLmNvcygoYXggKiBNYXRoLlBJKSAvIDE4MCk7XG4gIGNvbnN0IHMgPSBNYXRoLnNpbigoYXggKiBNYXRoLlBJKSAvIDE4MCk7XG4gIGNvbnN0IG1hID0gW1xuICAgIHJ4ICogKG1bMF0gKiBjICsgbVsyXSAqIHMpLFxuICAgIHJ4ICogKG1bMV0gKiBjICsgbVszXSAqIHMpLFxuICAgIHJ5ICogKC1tWzBdICogcyArIG1bMl0gKiBjKSxcbiAgICByeSAqICgtbVsxXSAqIHMgKyBtWzNdICogYyksXG4gIF07XG5cbiAgLy8gbWEgKiB0cmFuc3Bvc2UobWEpID0gWyBKIEwgXVxuICAvLyAgICAgICAgICAgICAgICAgICAgICBbIEwgSyBdXG4gIC8vIEwgaXMgY2FsY3VsYXRlZCBsYXRlciAoaWYgdGhlIGltYWdlIGlzIG5vdCBhIGNpcmNsZSlcbiAgY29uc3QgSiA9IG1hWzBdICogbWFbMF0gKyBtYVsyXSAqIG1hWzJdO1xuICBjb25zdCBLID0gbWFbMV0gKiBtYVsxXSArIG1hWzNdICogbWFbM107XG5cbiAgLy8gdGhlIGRpc2NyaW1pbmFudCBvZiB0aGUgY2hhcmFjdGVyaXN0aWMgcG9seW5vbWlhbCBvZiBtYSAqIHRyYW5zcG9zZShtYSlcbiAgbGV0IEQgPSAoKG1hWzBdIC0gbWFbM10pICogKG1hWzBdIC0gbWFbM10pICsgKG1hWzJdICsgbWFbMV0pICogKG1hWzJdICsgbWFbMV0pKVxuICAgICAgICAgICogKChtYVswXSArIG1hWzNdKSAqIChtYVswXSArIG1hWzNdKSArIChtYVsyXSAtIG1hWzFdKSAqIChtYVsyXSAtIG1hWzFdKSk7XG5cbiAgLy8gdGhlIFwibWVhbiBlaWdlbnZhbHVlXCJcbiAgY29uc3QgSksgPSAoSiArIEspIC8gMjtcblxuICAvLyBjaGVjayBpZiB0aGUgaW1hZ2UgaXMgKGFsbW9zdCkgYSBjaXJjbGVcbiAgaWYgKEQgPCBlcHNpbG9uICogSkspIHtcbiAgICAvLyBpZiBpdCBpc1xuICAgIGNvbnN0IHJ4eSA9IE1hdGguc3FydChKSyk7XG5cbiAgICByZXR1cm4geyByeDogcnh5LCByeTogcnh5LCBheDogMCB9O1xuICB9XG5cbiAgLy8gaWYgaXQgaXMgbm90IGEgY2lyY2xlXG4gIGNvbnN0IEwgPSBtYVswXSAqIG1hWzFdICsgbWFbMl0gKiBtYVszXTtcblxuICBEID0gTWF0aC5zcXJ0KEQpO1xuXG4gIC8vIHtsMSxsMn0gPSB0aGUgdHdvIGVpZ2VuIHZhbHVlcyBvZiBtYSAqIHRyYW5zcG9zZShtYSlcbiAgY29uc3QgbDEgPSBKSyArIEQgLyAyO1xuICBjb25zdCBsMiA9IEpLIC0gRCAvIDI7XG4gIC8vIHRoZSB4IC0gYXhpcyAtIHJvdGF0aW9uIGFuZ2xlIGlzIHRoZSBhcmd1bWVudCBvZiB0aGUgbDEgLSBlaWdlbnZlY3RvclxuICBsZXQgQVggPSAoTWF0aC5hYnMoTCkgPCBlcHNpbG9uICYmIE1hdGguYWJzKGwxIC0gSykgPCBlcHNpbG9uKSA/IDkwXG4gICAgOiBNYXRoLmF0YW4oTWF0aC5hYnMoTCkgPiBNYXRoLmFicyhsMSAtIEspID8gKGwxIC0gSikgLyBMXG4gICAgICA6ICgoTCAvIChsMSAtIEspKSkgKiAxODApIC8gTWF0aC5QSTtcbiAgbGV0IFJYO1xuICBsZXQgUlk7XG5cbiAgLy8gaWYgYXggPiAwID0+IHJ4ID0gc3FydChsMSksIHJ5ID0gc3FydChsMiksIGVsc2UgZXhjaGFuZ2UgYXhlcyBhbmQgYXggKz0gOTBcbiAgaWYgKEFYID49IDApIHtcbiAgICAvLyBpZiBheCBpbiBbMCw5MF1cbiAgICBSWCA9IE1hdGguc3FydChsMSk7XG4gICAgUlkgPSBNYXRoLnNxcnQobDIpO1xuICB9IGVsc2Uge1xuICAgIC8vIGlmIGF4IGluIF0tOTAsMFsgPT4gZXhjaGFuZ2UgYXhlc1xuICAgIEFYICs9IDkwO1xuICAgIFJYID0gTWF0aC5zcXJ0KGwyKTtcbiAgICBSWSA9IE1hdGguc3FydChsMSk7XG4gIH1cblxuICByZXR1cm4geyByeDogUlgsIHJ5OiBSWSwgYXg6IEFYIH07XG59XG4iXX0=