// SVGPathCommander v0.0.6 | thednp Â© 2020 | MIT-License
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).SVGPathCommander=t()}(this,(function(){"use strict";function e(t){return t.map((function(t){return Array.isArray(t)?e(t):isNaN(+t)?t:+t}))}var t={decimals:3,round:1};function n(n){return t.round?n.map((function(e){return e.map((function(e,n){var a=+e,r=Math.pow(10,t.decimals);return n?a%1==0?a:(a*r>>0)/r:e}))})):e(n)}function a(e){return this.segments=[],this.pathValue=e,this.max=e.length,this.index=0,this.param=0,this.segmentStart=0,this.data=[],this.err="",this}var r={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0};function c(e){var t=e.pathValue[e.segmentStart],n=t.toLowerCase(),a=e.data;if("m"===n&&a.length>2&&(e.segments.push([t,a[0],a[1]]),a=a.slice(2),n="l",t="m"===t?"l":"L"),"r"===n)e.segments.push([t].concat(a));else for(;a.length>=r[n]&&(e.segments.push([t].concat(a.splice(0,r[n]))),r[n]););}function i(e){var t=e.pathValue.charCodeAt(e.index);return 48===t?(e.param=0,void e.index++):49===t?(e.param=1,void e.index++):void(e.err="Invalid path value")}function s(e){return e>=48&&e<=57}function o(e){var t,n=e.index,a=n,r=e.max,c=!1,i=!1,o=!1,u=!1;if(a>=r)e.err="Invalid path value";else if(43!==(t=e.pathValue.charCodeAt(a))&&45!==t||(t=++a<r?e.pathValue.charCodeAt(a):0),s(t)||46===t){if(46!==t){if(c=48===t,t=++a<r?e.pathValue.charCodeAt(a):0,c&&a<r&&t&&s(t))return void(e.err="Invalid path value");for(;a<r&&s(e.pathValue.charCodeAt(a));)a++,i=!0;t=a<r?e.pathValue.charCodeAt(a):0}if(46===t){for(u=!0,a++;s(e.pathValue.charCodeAt(a));)a++,o=!0;t=a<r?e.pathValue.charCodeAt(a):0}if(101===t||69===t){if(u&&!i&&!o)return void(e.err="Invalid path value");if(43!==(t=++a<r?e.pathValue.charCodeAt(a):0)&&45!==t||a++,!(a<r&&s(e.pathValue.charCodeAt(a))))return void(e.err="Invalid path value");for(;a<r&&s(e.pathValue.charCodeAt(a));)a++}e.index=a,e.param=+e.pathValue.slice(n,a)}else e.err="Invalid path value"}function u(e){return e>=48&&e<=57||43===e||45===e||46===e}function h(e){for(;e.index<e.max&&(10===(t=e.pathValue.charCodeAt(e.index))||13===t||8232===t||8233===t||32===t||9===t||11===t||12===t||160===t||t>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(t)>=0);)e.index++;var t}function l(e){var t,n,a,s,l=e.max;if(e.segmentStart=e.index,function(e){switch(32|e){case 109:case 122:case 108:case 104:case 118:case 99:case 115:case 113:case 116:case 97:case 114:return!0}return!1}(t=e.pathValue.charCodeAt(e.index)))if(a=r[e.pathValue[e.index].toLowerCase()],e.index++,h(e),e.data=[],a){for(n=!1;;){for(s=a;s>0;s--){if(97!=(32|t)||3!==s&&4!==s?o(e):i(e),e.err.length)return;e.data.push(e.param),h(e),n=!1,e.index<l&&44===e.pathValue.charCodeAt(e.index)&&(e.index++,h(e),n=!0)}if(!n){if(e.index>=e.max)break;if(!u(e.pathValue.charCodeAt(e.index)))break}}c(e)}else c(e);else e.err="Invalid path value"}function f(e){return Array.isArray(e)&&e.every((function(e){var t=e[0].toLowerCase();return r[t]===e.length-1&&/[achlmrqstvz]/g.test(t)}))}function p(t){if(f(t))return e(t);var r=new a(t),c=r.max;for(h(r);r.index<c&&!r.err.length;)l(r);return r.err.length?r.segments=[]:r.segments.length&&("mM".indexOf(r.segments[0][0])<0?(r.err="Invalid path value",r.segments=[]):r.segments[0][0]="M"),n(r.segments)}function x(e,t){for(var n=[],a=0,r=e.length;r-2*!t>a;a+=2){var c=[{x:+e[a-2],y:+e[a-1]},{x:+e[a],y:+e[a+1]},{x:+e[a+2],y:+e[a+3]},{x:+e[a+4],y:+e[a+5]}];t?a?r-4==a?c[3]={x:+e[0],y:+e[1]}:r-2==a&&(c[2]={x:+e[0],y:+e[1]},c[3]={x:+e[2],y:+e[3]}):c[0]={x:+e[r-2],y:+e[r-1]}:r-4==a?c[3]=c[2]:a||(c[0]={x:+e[a],y:+e[a+1]}),n.push(["C",(-c[0].x+6*c[1].x+c[2].x)/6,(-c[0].y+6*c[1].y+c[2].y)/6,(c[1].x+6*c[2].x-c[3].x)/6,(c[1].y+6*c[2].y-c[3].y)/6,c[2].x,c[2].y])}return n}function v(e,t,n,a,r){var c;if(null==r&&null==a&&(a=n),e=+e,t=+t,n=+n,a=+a,null!=r){var i=Math.PI/180,s=e+n*Math.cos(-a*i),o=e+n*Math.cos(-r*i);c=[["M",s,t+n*Math.sin(-a*i)],["A",n,n,0,+(r-a>180),0,o,t+n*Math.sin(-r*i)]]}else c=[["M",e,t],["m",0,-a],["a",n,a,0,1,1,0,2*a],["a",n,a,0,1,1,0,-2*a],["z"]];return c}function d(e){return f(e)&&e.every((function(e){return e[0]===e[0].toUpperCase()}))}function y(t){if(d(t))return e(t);t=p(t);var a=[],r=0,c=0,i=0,s=0,o=0,u=t.length,h=3===t.length&&"M"===t[0][0]&&"R"===t[1][0].toUpperCase()&&"Z"===t[2][0].toUpperCase();"M"===t[0][0]&&(r=+t[0][1],c=+t[0][2],i=r,s=c,o++,a[0]=["M",r,c]);for(var l=function(e){var n=[],o=t[e],u=o[0],l=[];if(a.push(n=[]),u!==u.toUpperCase())switch(n[0]=u.toUpperCase(),n[0]){case"A":n[1]=o[1],n[2]=o[2],n[3]=o[3],n[4]=o[4],n[5]=o[5],n[6]=+o[6]+r,n[7]=+o[7]+c;break;case"V":n[1]=+o[1]+c;break;case"H":n[1]=+o[1]+r;break;case"R":for(var f=2,p=(l=[r,c].concat(o.slice(1))).length;f<p;f++)l[f]=+l[f]+r,l[++f]=+l[f]+c;a.pop(),a=a.concat(x(l,h));break;case"O":a.pop(),(l=v(r,c,+o[1],+o[2])).push(l[0]),a=a.concat(l);break;case"U":a.pop(),a=a.concat(v(r,c,o[1],o[2],o[3])),n=["U"].concat(a[a.length-1].slice(-2));break;case"M":i=+o[1]+r,s=+o[2]+c;default:for(var d=1,y=o.length;d<y;d++)n[d]=+o[d]+(d%2?r:c)}else"R"===u?(l=[r,c].concat(o.slice(1)),a.pop(),a=a.concat(x(l,h)),n=["R"].concat(o.slice(-2))):"O"===u?(a.pop(),(l=v(r,c,+o[1],+o[2])).push(l[0]),a=a.concat(l)):"U"===u?(a.pop(),a=a.concat(v(r,c,+o[1],+o[2],+o[3])),n=["U"].concat(a[a.length-1].slice(-2))):o.map((function(e){return n.push(e)}));if("O"!==(u=u.toUpperCase()))switch(n[0]){case"Z":r=i,c=s;break;case"H":r=+n[1];break;case"V":c=+n[1];break;case"M":i=+n[n.length-2],s=+n[n.length-1];default:r=+n[n.length-2],c=+n[n.length-1]}},f=o;f<u;f++)l(f);return n(a)}function g(e){return f(e)&&e.slice(1).every((function(e){return e[0]===e[0].toLowerCase()}))}function m(t){if(g(t))return e(t);t=p(t);var a=[],r=0,c=0,i=0,s=0,o=0,u=t.length;"M"===t[0][0]&&(r=+t[0][1],c=+t[0][2],i=r,s=c,o++,a.push(["M",r,c]));for(var h=function(e){var n=[],o=t[e];if(a.push(n=[]),o[0]!==o[0].toLowerCase())switch(n[0]=o[0].toLowerCase(),n[0]){case"a":n[1]=o[1],n[2]=o[2],n[3]=o[3],n[4]=o[4],n[5]=o[5],n[6]=+o[6]-r,n[7]=+o[7]-c;break;case"v":n[1]=+o[1]-c;break;case"m":i=+o[1],s=+o[2];default:for(var u=1,h=o.length;u<h;u++)n[u]=+o[u]-(u%2?r:c)}else n=[],a[e]=n,"m"===o[0]&&(i=+o[1]+r,s=+o[2]+c),o.map((function(t){return a[e].push(t)}));var l=a[e].length;switch(a[e][0]){case"z":r=i,c=s;break;case"h":r+=a[e][l-1];break;case"v":c+=a[e][l-1];break;default:r+=a[e][l-2],c+=a[e][l-1]}},l=o;l<u;l++)h(l);return n(a)}function C(e){return e.map((function(e){return e[0].concat(e.slice(1).join(" "))})).join("")}function M(e,t,n){var a,r;switch(e[0]){case"S":r=function(e,t,n,a,r){return"CS".indexOf(r)>-1?{x1:2*e-n,y1:2*t-a}:{x1:e,y1:t}}(t.x1,t.y1,t.x2,t.y2,n),t.x1=r.x1,t.y1=r.y1,e=["C",r.x1,r.y1].concat(e.slice(1));break;case"T":a=function(e,t,n,a,r){return"QT".indexOf(r)>-1?{qx:2*e-n,qy:2*t-a}:{qx:e,qy:t}}(t.x1,t.y1,t.qx,t.qy,n),t.qx=a.qx,t.qy=a.qy,e=["Q",t.qx,t.qy].concat(e.slice(1));break;case"Q":t.qx=e[1],t.qy=e[2];break;case"H":e=["L",e[1],t.y1];break;case"V":e=["L",t.x1,e[1]]}return e}function b(e){for(var t,a,r={x1:0,y1:0,x2:0,y2:0,x:0,y:0,qx:null,qy:null},c=[],i="",s="",o=(e=y(e)).length,u=0;u<o;u++)e[u]&&(i=e[u][0]),c[u]=i,u&&(s=c[u-1]),e[u]=M(e[u],r,s),a=(t=e[u]).length,r.x1=+t[a-2],r.y1=+t[a-1],r.x2=+t[a-4]||r.x1,r.y2=+t[a-3]||r.y1;return n(e)}function A(e){var t=y(e),n="Z"===t.slice(-1)[0][0],a=[];return a=b(t).map((function(e,n){return{c:t[n][0],x:e[e.length-2],y:e[e.length-1],seg:t[n],normalized:e}})).map((function(e,t,a){var r=e.seg,c=e.normalized,i=t&&a[t-1],s=a[t+1]&&a[t+1],o=e.c,u=a.length,h=t?a[t-1].x:a[u-1].x,l=t?a[t-1].y:a[u-1].y,f=[];switch(o){case"M":f=n?["Z"]:[o,h,l];break;case"A":f=r.slice(0,-3).concat([1===r[5]?0:1,h,l]);break;case"C":f=s&&"S"===s.c?["S",r[1],r[2],h,l]:[o,r[3],r[4],r[1],r[2],h,l];break;case"S":f=i&&"CS".indexOf(i.c)>-1&&(!s||s&&"S"!==s.c)?["C",c[3],c[4],c[1],c[2],h,l]:[o,c[1],c[2],h,l];break;case"Q":f=s&&"T"===s.c?["T",h,l]:r.slice(-2).concat([h,l]);break;case"T":f=i&&"QT".indexOf(i.c)>-1&&(!s||s&&"T"!==s.c)?["Q",c[1],c[2],h,l]:[o,h,l];break;case"Z":f=["M",h,l];break;case"H":f=[o,h];break;case"V":f=[o,l];break;default:f=r.slice(0,-2).concat([h,l])}return f})),n?a.reverse():[a[0]].concat(a.slice(1).reverse())}function k(e){return e.replace(/(m|M)/g,"|$1").split("|").map((function(e){return e.trim()})).filter((function(e){return e}))}function q(e){var t=y(e),n=m(e);return t.map((function(e,t){return t?e.join("").length<n[t].join("").length?e:n[t]:e}))}var V=function(t){var n=p(t);return this.segments=e(n),this.pathValue=t,this};function w(e){return e.slice(1).map((function(e,t,n){var a,r,c,i,s,o,u,h,l,f=n[0===t?n.length-1:t-1];return a=f.slice(f.length-2).concat(e.slice(1)),r=a[0],c=a[1],i=a[2],s=a[3],o=a[4],u=a[5],h=a[6],3*(((l=a[7])-c)*(i+o)-(h-r)*(s+u)+s*(r-o)-i*(c-u)+l*(o+r/3)-h*(u+c/3))/20})).reduce((function(e,t){return e+t}),0)}function P(e){return f(e)&&e.slice(1).every((function(e){return"C"===e[0]}))}function I(e,t,n){if(e[n].length>7){e[n].shift();for(var a=e[n];a.length;)t[n]="A",e.splice(n++,0,["C"].concat(a.splice(0,6)));e.splice(n,1)}}function S(e,t,n){return{x:e*Math.cos(n)-t*Math.sin(n),y:e*Math.sin(n)+t*Math.cos(n)}}function T(e,t,n,a,r,c,i,s,o,u){var h,l,f,p,x,v=120*Math.PI/180,d=Math.PI/180*(r||0),y=[];if(u)l=u[0],f=u[1],p=u[2],x=u[3];else{e=(h=S(e,t,-d)).x,t=h.y;var g=(e-(s=(h=S(s,o,-d)).x))/2,m=(t-(o=h.y))/2,C=g*g/(n*n)+m*m/(a*a);C>1&&(n*=C=Math.sqrt(C),a*=C);var M=n*n,b=a*a,A=(c==i?-1:1)*Math.sqrt(Math.abs((M*b-M*m*m-b*g*g)/(M*m*m+b*g*g)));p=A*n*m/a+(e+s)/2,x=A*-a*g/n+(t+o)/2,l=Math.asin(((t-x)/a).toFixed(9)),f=Math.asin(((o-x)/a).toFixed(9)),l=e<p?Math.PI-l:l,f=s<p?Math.PI-f:f,l<0&&(l=2*Math.PI+l),f<0&&(f=2*Math.PI+f),i&&l>f&&(l-=2*Math.PI),!i&&f>l&&(f-=2*Math.PI)}var k=f-l;if(Math.abs(k)>v){var q=f,V=s,w=o;f=l+v*(i&&f>l?1:-1),s=p+n*Math.cos(f),o=x+a*Math.sin(f),y=T(s,o,n,a,r,0,i,V,w,[f,q,p,x])}k=f-l;var P=Math.cos(l),I=Math.sin(l),L=Math.cos(f),O=Math.sin(f),U=Math.tan(k/4),z=4/3*n*U,Q=4/3*a*U,R=[e,t],j=[e+z*I,t-Q*P],Z=[s+z*O,o-Q*L],D=[s,o];return j[0]=2*R[0]-j[0],j[1]=2*R[1]-j[1],u?[j,Z,D].concat(y):(y=[j,Z,D].concat(y).join().split(",")).map((function(e,t){return t%2?S(y[t-1],e,d).y:S(e,y[t+1],d).x}))}function L(e,t,n,a){return[e,t,n,a,n,a]}function O(e,t){switch("TQ".indexOf(e[0])<0&&(t.qx=t.qy=null),e[0]){case"M":t.x=e[1],t.y=e[2];break;case"A":e=["C"].concat(T.apply(0,[t.x1,t.y1].concat(e.slice(1))));break;case"Q":t.qx=e[1],t.qy=e[2],e=["C"].concat((n=t.x1,a=t.y1,r=e[1],c=e[2],i=e[3],s=e[4],[1/3*n+2/3*r,1/3*a+2/3*c,1/3*i+2/3*r,1/3*s+2/3*c,i,s]));break;case"L":e=["C"].concat(L(t.x1,t.y1,e[1],e[2]));break;case"Z":e=["C"].concat(L(t.x1,t.y1,t.x,t.y))}var n,a,r,c,i,s;return e}V.prototype.toAbsolute=function(){var t=y(this.segments);return this.segments=e(t),this},V.prototype.toRelative=function(){var t=m(this.segments);return this.segments=e(t),this},V.prototype.reverse=function(t){this.toAbsolute();var n=k(this.pathValue).length>1&&k(this.toString()),a=n&&e(n).map((function(e,n){return t?n?A(e):p(e):A(e)})),r=n?[].concat.apply([],a):t?this.segments:A(this.segments);return this.segments=e(r),this},V.prototype.optimize=function(){var t=q(this.segments);return this.segments=e(t),this},V.prototype.toString=function(){return C(this.segments)};var U={getShapeArea:w,getDrawDirection:function(e){if(!P(e))throw"getDrawDirection expects a curveArray";return w(e)>=0},clonePath:e,splitPath:k,isPathArray:f,isCurveArray:P,isAbsoluteArray:d,isRelativeArray:g,roundPath:n,optimizePath:q,pathToAbsolute:y,pathToRelative:m,pathToCurve:function(t){if(P(t))return e(t);for(var a,r,c={x1:0,y1:0,x2:0,y2:0,x:0,y:0,qx:null,qy:null},i=[],s="",o=(t=b(t)).length,u=0;u<o;u++)t[u]&&(s=t[u][0]),"C"!==s&&(i[u]=s),t[u]=O(t[u],c),"A"!==i[u]&&"C"===s&&(i[u]="C"),I(t,i,u),o=t.length,r=(a=t[u]).length,c.x1=+a[r-2],c.y1=+a[r-1],c.x2=+a[r-4]||c.x1,c.y2=+a[r-3]||c.y1;return n(t)},pathToString:C,parsePathString:p,reverseCurve:function(e){var t=e.slice(1).map((function(t,n,a){return n?a[n-1].slice(-2).concat(t.slice(1)):e[0].slice(1).concat(t.slice(1))})).map((function(e){return e.map((function(t,n){return e[e.length-n-2*(1-n%2)]}))})).reverse();return[["M"].concat(t[0].slice(0,2))].concat(t.map((function(e){return["C"].concat(e.slice(2))})))},reversePath:A,normalizePath:b,options:t};for(var z in U)V[z]=U[z];return V}));
