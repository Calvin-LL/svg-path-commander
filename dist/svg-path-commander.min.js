// SVGPathCommander v0.0.5 | thednp Â© 2020 | MIT-License
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).SVGPathCommander=t()}(this,(function(){"use strict";function e(t){return t.map((function(t){return Array.isArray(t)?e(t):isNaN(+t)?t:+t}))}var t={decimals:3,round:1};function a(a){return t.round?a.map((function(e){return e.map((function(e,a){var n=+e,r=Math.pow(10,t.decimals);return a?n%1==0?n:(n*r>>0)/r:e}))})):e(a)}function n(e){return this.segments=[],this.pathValue=e,this.max=e.length,this.index=0,this.param=0,this.segmentStart=0,this.data=[],this.err="",this}var r={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0};function c(e){var t=e.pathValue[e.segmentStart],a=t.toLowerCase(),n=e.data;if("m"===a&&n.length>2&&(e.segments.push([t,n[0],n[1]]),n=n.slice(2),a="l",t="m"===t?"l":"L"),"r"===a)e.segments.push([t].concat(n));else for(;n.length>=r[a]&&(e.segments.push([t].concat(n.splice(0,r[a]))),r[a]););}function i(e){var t=e.pathValue.charCodeAt(e.index);return 48===t?(e.param=0,void e.index++):49===t?(e.param=1,void e.index++):void(e.err="Invalid path value")}function s(e){return e>=48&&e<=57}function o(e){var t,a=e.index,n=a,r=e.max,c=!1,i=!1,o=!1,u=!1;if(n>=r)e.err="Invalid path value";else if(43!==(t=e.pathValue.charCodeAt(n))&&45!==t||(t=++n<r?e.pathValue.charCodeAt(n):0),s(t)||46===t){if(46!==t){if(c=48===t,t=++n<r?e.pathValue.charCodeAt(n):0,c&&n<r&&t&&s(t))return void(e.err="Invalid path value");for(;n<r&&s(e.pathValue.charCodeAt(n));)n++,i=!0;t=n<r?e.pathValue.charCodeAt(n):0}if(46===t){for(u=!0,n++;s(e.pathValue.charCodeAt(n));)n++,o=!0;t=n<r?e.pathValue.charCodeAt(n):0}if(101===t||69===t){if(u&&!i&&!o)return void(e.err="Invalid path value");if(43!==(t=++n<r?e.pathValue.charCodeAt(n):0)&&45!==t||n++,!(n<r&&s(e.pathValue.charCodeAt(n))))return void(e.err="Invalid path value");for(;n<r&&s(e.pathValue.charCodeAt(n));)n++}e.index=n,e.param=+e.pathValue.slice(a,n)}else e.err="Invalid path value"}function u(e){return e>=48&&e<=57||43===e||45===e||46===e}function h(e){for(;e.index<e.max&&(10===(t=e.pathValue.charCodeAt(e.index))||13===t||8232===t||8233===t||32===t||9===t||11===t||12===t||160===t||t>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(t)>=0);)e.index++;var t}function l(e){var t,a,n,s,l=e.max;if(e.segmentStart=e.index,function(e){switch(32|e){case 109:case 122:case 108:case 104:case 118:case 99:case 115:case 113:case 116:case 97:case 114:return!0}return!1}(t=e.pathValue.charCodeAt(e.index)))if(n=r[e.pathValue[e.index].toLowerCase()],e.index++,h(e),e.data=[],n){for(a=!1;;){for(s=n;s>0;s--){if(97!=(32|t)||3!==s&&4!==s?o(e):i(e),e.err.length)return;e.data.push(e.param),h(e),a=!1,e.index<l&&44===e.pathValue.charCodeAt(e.index)&&(e.index++,h(e),a=!0)}if(!a){if(e.index>=e.max)break;if(!u(e.pathValue.charCodeAt(e.index)))break}}c(e)}else c(e);else e.err="Invalid path value"}function f(e){return Array.isArray(e)&&e.every((function(e){var t=e[0].toLowerCase();return r[t]===e.length-1&&/[achlmrqstvz]/g.test(t)}))}function p(t){if(f(t))return e(t);var r=new n(t),c=r.max;for(h(r);r.index<c&&!r.err.length;)l(r);return r.err.length?r.segments=[]:r.segments.length&&("mM".indexOf(r.segments[0][0])<0?(r.err="Invalid path value",r.segments=[]):r.segments[0][0]="M"),a(r.segments)}function v(e,t){for(var a=[],n=0,r=e.length;r-2*!t>n;n+=2){var c=[{x:+e[n-2],y:+e[n-1]},{x:+e[n],y:+e[n+1]},{x:+e[n+2],y:+e[n+3]},{x:+e[n+4],y:+e[n+5]}];t?n?r-4==n?c[3]={x:+e[0],y:+e[1]}:r-2==n&&(c[2]={x:+e[0],y:+e[1]},c[3]={x:+e[2],y:+e[3]}):c[0]={x:+e[r-2],y:+e[r-1]}:r-4==n?c[3]=c[2]:n||(c[0]={x:+e[n],y:+e[n+1]}),a.push(["C",(-c[0].x+6*c[1].x+c[2].x)/6,(-c[0].y+6*c[1].y+c[2].y)/6,(c[1].x+6*c[2].x-c[3].x)/6,(c[1].y+6*c[2].y-c[3].y)/6,c[2].x,c[2].y])}return a}function x(e,t,a,n,r){var c;if(null==r&&null==n&&(n=a),e=+e,t=+t,a=+a,n=+n,null!=r){var i=Math.PI/180,s=e+a*Math.cos(-n*i),o=e+a*Math.cos(-r*i);c=[["M",s,t+a*Math.sin(-n*i)],["A",a,a,0,+(r-n>180),0,o,t+a*Math.sin(-r*i)]]}else c=[["M",e,t],["m",0,-n],["a",a,n,0,1,1,0,2*n],["a",a,n,0,1,1,0,-2*n],["z"]];return c}function d(e){return f(e)&&e.every((function(e){return e[0]===e[0].toUpperCase()}))}function g(t){if(d(t))return e(t);t=p(t);var n=[],r=0,c=0,i=0,s=0,o=0,u=t.length,h=3===t.length&&"M"===t[0][0]&&"R"===t[1][0].toUpperCase()&&"Z"===t[2][0].toUpperCase();"M"===t[0][0]&&(r=+t[0][1],c=+t[0][2],i=r,s=c,o++,n[0]=["M",r,c]);for(var l=function(e){var a=[],o=t[e],u=o[0],l=[];if(n.push(a=[]),u!==u.toUpperCase())switch(a[0]=u.toUpperCase(),a[0]){case"A":a[1]=o[1],a[2]=o[2],a[3]=o[3],a[4]=o[4],a[5]=o[5],a[6]=+o[6]+r,a[7]=+o[7]+c;break;case"V":a[1]=+o[1]+c;break;case"H":a[1]=+o[1]+r;break;case"R":for(var f=2,p=(l=[r,c].concat(o.slice(1))).length;f<p;f++)l[f]=+l[f]+r,l[++f]=+l[f]+c;n.pop(),n=n.concat(v(l,h));break;case"O":n.pop(),(l=x(r,c,+o[1],+o[2])).push(l[0]),n=n.concat(l);break;case"U":n.pop(),n=n.concat(x(r,c,o[1],o[2],o[3])),a=["U"].concat(n[n.length-1].slice(-2));break;case"M":i=+o[1]+r,s=+o[2]+c;default:for(var d=1,g=o.length;d<g;d++)a[d]=+o[d]+(d%2?r:c)}else"R"===u?(l=[r,c].concat(o.slice(1)),n.pop(),n=n.concat(v(l,h)),a=["R"].concat(o.slice(-2))):"O"===u?(n.pop(),(l=x(r,c,+o[1],+o[2])).push(l[0]),n=n.concat(l)):"U"===u?(n.pop(),n=n.concat(x(r,c,+o[1],+o[2],+o[3])),a=["U"].concat(n[n.length-1].slice(-2))):o.map((function(e){return a.push(e)}));if("O"!==(u=u.toUpperCase()))switch(a[0]){case"Z":r=i,c=s;break;case"H":r=+a[1];break;case"V":c=+a[1];break;case"M":i=+a[a.length-2],s=+a[a.length-1];default:r=+a[a.length-2],c=+a[a.length-1]}},f=o;f<u;f++)l(f);return a(n)}function y(e){return f(e)&&e.slice(1).every((function(e){return e[0]===e[0].toLowerCase()}))}function m(t){if(y(t))return e(t);t=p(t);var n=[],r=0,c=0,i=0,s=0,o=0,u=t.length;"M"===t[0][0]&&(r=+t[0][1],c=+t[0][2],i=r,s=c,o++,n.push(["M",r,c]));for(var h=function(e){var a=[],o=t[e];if(n.push(a=[]),o[0]!==o[0].toLowerCase())switch(a[0]=o[0].toLowerCase(),a[0]){case"a":a[1]=o[1],a[2]=o[2],a[3]=o[3],a[4]=o[4],a[5]=o[5],a[6]=+o[6]-r,a[7]=+o[7]-c;break;case"v":a[1]=+o[1]-c;break;case"m":i=+o[1],s=+o[2];default:for(var u=1,h=o.length;u<h;u++)a[u]=+o[u]-(u%2?r:c)}else a=[],n[e]=a,"m"===o[0]&&(i=+o[1]+r,s=+o[2]+c),o.map((function(t){return n[e].push(t)}));var l=n[e].length;switch(n[e][0]){case"z":r=i,c=s;break;case"h":r+=n[e][l-1];break;case"v":c+=n[e][l-1];break;default:r+=n[e][l-2],c+=n[e][l-1]}},l=o;l<u;l++)h(l);return a(n)}function C(e){return e.map((function(e){return e[0].concat(e.slice(1).join(" "))})).join(" ")}function b(e){var t,a,n,r=g(e),c="Z"===r.slice(-1)[0][0],i=0,s=0;return n=r.map((function(e,n,r){switch(a=r.length,t=e[0]){case"M":i=e[1],s=e[2];break;case"Z":i=r[0][1],s=r[0][2];break;case"V":i=i,s=e[1];break;case"H":i=e[1],s=s;break;default:i=e[e.length-2],s=e[e.length-1]}return{c:t,x:i,y:s,seg:e}})).map((function(e,n,r){var o,u,h,l=0,f=0,p=0,v=0,x=e.seg,d=[];switch(a=r.length,t=e.c,i=n?r[n-1].x:r[a-1].x,s=n?r[n-1].y:r[a-1].y,t){case"M":d=c?["Z"]:[t,i,s];break;case"A":l=x[1],f=x[2],o=x[3],u=x[4],h=1===x[5]?0:1,d=[t,l,f,o,u,h,i,s];break;case"C":l=x[3],f=x[4],p=x[1],v=x[2],d=[t,l,f,p,v,i,s];break;case"Z":d=["M",i,s];break;case"H":d=[t,i];break;case"V":d=[t,s];break;default:d=x.slice(0,-2).concat([i,s])}return d})),c?n.reverse():[n[0]].concat(n.slice(1).reverse())}function M(e){return e.replace(/(m|M)/g,"|$1").split("|").map((function(e){return e.trim()})).filter((function(e){return e}))}function A(e){var t=g(e),a=m(e);return t.map((function(e,t){return t?e.join("").length<a[t].join("").length?e:a[t]:e}))}var k=function(t){var a=p(t);return this.segments=e(a),this.pathValue=t,this};function V(e){return e.slice(1).map((function(e,t,a){var n,r,c,i,s,o,u,h,l,f=a[0===t?a.length-1:t-1];return n=f.slice(f.length-2).concat(e.slice(1)),r=n[0],c=n[1],i=n[2],s=n[3],o=n[4],u=n[5],h=n[6],3*(((l=n[7])-c)*(i+o)-(h-r)*(s+u)+s*(r-o)-i*(c-u)+l*(o+r/3)-h*(u+c/3))/20})).reduce((function(e,t){return e+t}),0)}function w(e){return f(e)&&e.slice(1).every((function(e){return"C"===e[0]}))}function q(e,t,a){return[e[0]*(1-a)+t[0]*a,e[1]*(1-a)+t[1]*a]}function I(e,t,a){return{x:e*Math.cos(a)-t*Math.sin(a),y:e*Math.sin(a)+t*Math.cos(a)}}function P(e,t,a,n,r,c,i,s,o,u){var h,l,f,p,v,x=120*Math.PI/180,d=Math.PI/180*(r||0),g=[];if(u)l=u[0],f=u[1],p=u[2],v=u[3];else{e=(h=I(e,t,-d)).x,t=h.y;var y=(e-(s=(h=I(s,o,-d)).x))/2,m=(t-(o=h.y))/2,C=y*y/(a*a)+m*m/(n*n);C>1&&(a*=C=Math.sqrt(C),n*=C);var b=a*a,M=n*n,A=(c==i?-1:1)*Math.sqrt(Math.abs((b*M-b*m*m-M*y*y)/(b*m*m+M*y*y)));p=A*a*m/n+(e+s)/2,v=A*-n*y/a+(t+o)/2,l=Math.asin(((t-v)/n).toFixed(9)),f=Math.asin(((o-v)/n).toFixed(9)),l=e<p?Math.PI-l:l,f=s<p?Math.PI-f:f,l<0&&(l=2*Math.PI+l),f<0&&(f=2*Math.PI+f),i&&l>f&&(l-=2*Math.PI),!i&&f>l&&(f-=2*Math.PI)}var k=f-l;if(Math.abs(k)>x){var V=f,w=s,q=o;f=l+x*(i&&f>l?1:-1),s=p+a*Math.cos(f),o=v+n*Math.sin(f),g=P(s,o,a,n,r,0,i,w,q,[f,V,p,v])}k=f-l;var S=Math.cos(l),U=Math.sin(l),T=Math.cos(f),L=Math.sin(f),R=Math.tan(k/4),Z=4/3*a*R,j=4/3*n*R,z=[e,t],H=[e+Z*U,t-j*S],O=[s+Z*L,o-j*T],D=[s,o];return H[0]=2*z[0]-H[0],H[1]=2*z[1]-H[1],u?[H,O,D].concat(g):(g=[H,O,D].concat(g).join().split(",")).map((function(e,t){return t%2?I(g[t-1],e,d).y:I(e,g[t+1],d).x}))}function S(e,t,a,n,r,c){return[1/3*e+2/3*a,1/3*t+2/3*n,1/3*r+2/3*a,1/3*c+2/3*n,r,c]}function U(e,t,a,n){return[e,t,a,n,a,n]}function T(e,t,a){var n,r;switch(!(e[0]in{T:1,Q:1})&&(t.qx=t.qy=null),e[0]){case"M":t.X=e[1],t.Y=e[2];break;case"A":e=["C"].concat(P.apply(0,[t.x,t.y].concat(e.slice(1))));break;case"S":"C"===a||"S"===a?(n=2*t.x-t.bx,r=2*t.y-t.by):(n=t.x,r=t.y),e=["C",n,r].concat(e.slice(1));break;case"T":"Q"===a||"T"===a?(t.qx=2*t.x-t.qx,t.qy=2*t.y-t.qy):(t.qx=t.x,t.qy=t.y),e=["C"].concat(S(t.x,t.y,t.qx,t.qy,e[1],e[2]));break;case"Q":t.qx=e[1],t.qy=e[2],e=["C"].concat(S(t.x,t.y,e[1],e[2],e[3],e[4]));break;case"L":e=["C"].concat(U(t.x,t.y,e[1],e[2]));break;case"H":e=["C"].concat(U(t.x,t.y,e[1],t.y));break;case"V":e=["C"].concat(U(t.x,t.y,t.x,e[1]));break;case"Z":e=["C"].concat(U(t.x,t.y,t.X,t.Y))}return e}function L(e,t,a,n){if(e[a].length>7){e[a].shift();for(var r=e[a];r.length;)t[a]="A",e.splice(a++,0,["C"].concat(r.splice(0,6)));e.splice(a,1),e.length}}k.prototype.toAbsolute=function(){var t=g(this.segments);return this.segments=e(t),this},k.prototype.toRelative=function(){var t=m(this.segments);return this.segments=e(t),this},k.prototype.reverse=function(t){this.toAbsolute();var a=M(this.pathValue).length>1&&M(this.toString()),n=a&&e(a).map((function(e,a){return t?a?b(e):p(e):b(e)})),r=a?[].concat.apply([],n):t?this.segments:b(this.segments);return this.segments=e(r),this},k.prototype.optimize=function(){var t=A(this.segments);return this.segments=e(t),this},k.prototype.toString=function(){return C(this.segments)};var R={getShapeArea:V,getDrawDirection:function(e){if(!w(e))throw"getDrawDirection expects a curveArray";return V(e)>=0},clonePath:e,splitPath:M,splitCubic:function(e,t){t=t||.5;var a=e.slice(0,2),n=e.slice(2,4),r=e.slice(4,6),c=e.slice(6,8),i=q(a,n,t),s=q(n,r,t),o=q(r,c,t),u=q(i,s,t),h=q(s,o,t),l=q(u,h,t);return[["C"].concat(i,u,l),["C"].concat(h,o,c)]},isPathArray:f,isCurveArray:w,isAbsoluteArray:d,isRelativeArray:y,roundPath:a,optimizePath:A,pathToAbsolute:g,pathToRelative:m,pathToCurve:function t(n){if(w(n))return e(n);for(var r={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},c=[],i="",s="",o=(n=g(n)).length,u=0;u<o;u++){n[u]&&(i=n[u][0]),"C"!==i&&(c[u]=i,u&&(s=c[u-1])),n[u]=T(n[u],r,s),"A"!==c[u]&&"C"===i&&(c[u]="C"),L(n,c,u);var h=n[u],l=h.length;r.x=+h[l-2],r.y=+h[l-1],r.bx=+h[l-4]||r.x,r.by=+h[l-3]||r.y}return w(n)?a(n):t(n)},pathToString:C,parsePathString:p,reverseCurve:function(e){var t=e.slice(1).map((function(t,a,n){return a?n[a-1].slice(-2).concat(t.slice(1)):e[0].slice(1).concat(t.slice(1))})).map((function(e){return e.map((function(t,a){return e[e.length-a-2*(1-a%2)]}))})).reverse();return[["M"].concat(t[0].slice(0,2))].concat(t.map((function(e){return["C"].concat(e.slice(2))})))},reversePath:b,options:t};for(var Z in R)k[Z]=R[Z];return k}));
