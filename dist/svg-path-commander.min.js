// SVGPathCommander v0.0.1-d | thednp Â© 2020 | MIT-License
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).SVGPathCommander=e()}(this,(function(){"use strict";function t(e){return e.map((function(e){return Array.isArray(e)?t(e):isNaN(+e)?e:+e}))}var e={decimals:3,round:1};function a(a){return e.round?a.map((function(t){return t.map((function(t,a){var n=+t,r=Math.pow(10,e.decimals);return a?n%1==0?n:(n*r>>0)/r:t}))})):t(a)}function n(t){return this.segments=[],this.pathValue=t,this.max=t.length,this.index=0,this.param=0,this.segmentStart=0,this.data=[],this.err="",this}var r={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0};function s(t){return t>=48&&t<=57}function o(t){return t>=48&&t<=57||43===t||45===t||46===t}function i(t){for(;t.index<t.max&&(10===(e=t.pathValue.charCodeAt(t.index))||13===e||8232===e||8233===e||32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0);)t.index++;var e}function c(t){var e=t.pathValue.charCodeAt(t.index);return 48===e?(t.param=0,void t.index++):49===e?(t.param=1,void t.index++):void(t.err="SvgPath: arc flag can be 0 or 1 only (at pos "+t.index+")")}function h(t){var e,a=t.index,n=a,r=t.max,o=!1,i=!1,c=!1,h=!1;if(n>=r)t.err="SvgPath: missed param (at pos "+n+")";else if(43!==(e=t.pathValue.charCodeAt(n))&&45!==e||(e=++n<r?t.pathValue.charCodeAt(n):0),s(e)||46===e){if(46!==e){if(o=48===e,e=++n<r?t.pathValue.charCodeAt(n):0,o&&n<r&&e&&s(e))return void(t.err="SvgPath: numbers started with `0` such as `09` are illegal (at pos "+a+")");for(;n<r&&s(t.pathValue.charCodeAt(n));)n++,i=!0;e=n<r?t.pathValue.charCodeAt(n):0}if(46===e){for(h=!0,n++;s(t.pathValue.charCodeAt(n));)n++,c=!0;e=n<r?t.pathValue.charCodeAt(n):0}if(101===e||69===e){if(h&&!i&&!c)return void(t.err="SvgPath: invalid float exponent (at pos "+n+")");if(43!==(e=++n<r?t.pathValue.charCodeAt(n):0)&&45!==e||n++,!(n<r&&s(t.pathValue.charCodeAt(n))))return void(t.err="SvgPath: invalid float exponent (at pos "+n+")");for(;n<r&&s(t.pathValue.charCodeAt(n));)n++}t.index=n,t.param=parseFloat(t.pathValue.slice(a,n))+0}else t.err="SvgPath: param should start with 0..9 or `.` (at pos "+n+")"}function u(t){var e=t.pathValue[t.segmentStart],a=e.toLowerCase(),n=t.data;if("m"===a&&n.length>2&&(t.segments.push([e,n[0],n[1]]),n=n.slice(2),a="l",e="m"===e?"l":"L"),"r"===a)t.segments.push([e].concat(n));else for(;n.length>=r[a]&&(t.segments.push([e].concat(n.splice(0,r[a]))),r[a]););}function l(t){var e,a,n,s,l,p=t.max;if(t.segmentStart=t.index,e=t.pathValue.charCodeAt(t.index),a=97==(32|e),function(t){switch(32|t){case 109:case 122:case 108:case 104:case 118:case 99:case 115:case 113:case 116:case 97:case 114:return!0}return!1}(e))if(s=r[t.pathValue[t.index].toLowerCase()],t.index++,i(t),t.data=[],s){for(n=!1;;){for(l=s;l>0;l--){if(!a||3!==l&&4!==l?h(t):c(t),t.err.length)return;t.data.push(t.param),i(t),n=!1,t.index<p&&44===t.pathValue.charCodeAt(t.index)&&(t.index++,i(t),n=!0)}if(!n){if(t.index>=t.max)break;if(!o(t.pathValue.charCodeAt(t.index)))break}}u(t)}else u(t);else t.err="SvgPath: bad command "+t.pathValue[t.index]+" (at pos "+t.index+")"}function p(e){if(Array.isArray(e))return t(e);var r=new n(e),s=r.max;for(i(r);r.index<s&&!r.err.length;)l(r);return r.err.length?r.segments=[]:r.segments.length&&("mM".indexOf(r.segments[0][0])<0?(r.err="SvgPath: string should start with `M` or `m`",r.segments=[]):r.segments[0][0]="M"),a(r.segments)}function f(t,e){for(var a=[],n=0,r=t.length;r-2*!e>n;n+=2){var s=[{x:+t[n-2],y:+t[n-1]},{x:+t[n],y:+t[n+1]},{x:+t[n+2],y:+t[n+3]},{x:+t[n+4],y:+t[n+5]}];e?n?r-4==n?s[3]={x:+t[0],y:+t[1]}:r-2==n&&(s[2]={x:+t[0],y:+t[1]},s[3]={x:+t[2],y:+t[3]}):s[0]={x:+t[r-2],y:+t[r-1]}:r-4==n?s[3]=s[2]:n||(s[0]={x:+t[n],y:+t[n+1]}),a.push(["C",(-s[0].x+6*s[1].x+s[2].x)/6,(-s[0].y+6*s[1].y+s[2].y)/6,(s[1].x+6*s[2].x-s[3].x)/6,(s[1].y+6*s[2].y-s[3].y)/6,s[2].x,s[2].y])}return a}function x(t,e,a,n,r){var s;if(null==r&&null==n&&(n=a),t=+t,e=+e,a=+a,n=+n,null!=r){var o=Math.PI/180,i=t+a*Math.cos(-n*o),c=t+a*Math.cos(-r*o);s=[["M",i,e+a*Math.sin(-n*o)],["A",a,a,0,+(r-n>180),0,c,e+a*Math.sin(-r*o)]]}else s=[["M",t,e],["m",0,-n],["a",a,n,0,1,1,0,2*n],["a",a,n,0,1,1,0,-2*n],["z"]];return s}function g(t){if(!(t=p(t))||!t.length)return[["M",0,0]];var e=[],n=0,r=0,s=0,o=0,i=0,c=t.length,h=3===t.length&&"M"===t[0][0]&&"R"===t[1][0].toUpperCase()&&"Z"===t[2][0].toUpperCase();"M"===t[0][0]&&(n=+t[0][1],r=+t[0][2],s=n,o=r,i++,e[0]=["M",n,r]);for(var u=function(a){var i=void 0,c=t[a],u=c[0];if(e.push(i=[]),u!==u.toUpperCase())switch(i[0]=u.toUpperCase(),i[0]){case"A":i[1]=c[1],i[2]=c[2],i[3]=c[3],i[4]=c[4],i[5]=c[5],i[6]=+c[6]+n,i[7]=+c[7]+r;break;case"V":i[1]=+c[1]+r;break;case"H":i[1]=+c[1]+n;break;case"R":for(var l=[n,r].concat(c.slice(1)),p=2,g=l.length;p<g;p++)l[p]=+l[p]+n,l[++p]=+l[p]+r;e.pop(),e=e.concat(f(l,h));break;case"O":e.pop(),(l=x(n,r,+c[1],+c[2])).push(l[0]),e=e.concat(l);break;case"U":e.pop(),e=e.concat(x(n,r,c[1],c[2],c[3])),i=["U"].concat(e[e.length-1].slice(-2));break;case"M":s=+c[1]+n,o=+c[2]+r;default:for(var d=1,m=c.length;d<m;d++)i[d]=+c[d]+(d%2?n:r)}else"R"===u?(dots=[n,r].concat(c.slice(1)),e.pop(),e=e.concat(f(dots,h)),i=["R"].concat(c.slice(-2))):"O"===u?(e.pop(),dots=x(n,r,+c[1],+c[2]),dots.push(dots[0]),e=e.concat(dots)):"U"===u?(e.pop(),e=e.concat(x(n,r,+c[1],+c[2],+c[3])),i=["U"].concat(e[e.length-1].slice(-2))):c.map((function(t){return i.push(t)}));if("O"!==(u=u.toUpperCase()))switch(i[0]){case"Z":n=s,r=o;break;case"H":n=+i[1];break;case"V":r=+i[1];break;case"M":s=+i[i.length-2],o=+i[i.length-1];default:n=+i[i.length-2],r=+i[i.length-1]}},l=i;l<c;l++)u(l);return a(e)}function d(t){t=p(t);var e=[],n=0,r=0,s=0,o=0,i=0,c=t.length;"M"===t[0][0]&&(n=+t[0][1],r=+t[0][2],s=n,o=r,i++,e.push(["M",n,r]));for(var h=function(a){var i=void 0,c=t[a];if(e.push(i=[]),c[0]!==c[0].toLowerCase())switch(i[0]=c[0].toLowerCase(),i[0]){case"a":i[1]=c[1],i[2]=c[2],i[3]=c[3],i[4]=c[4],i[5]=c[5],i[6]=+c[6]-n,i[7]=+c[7]-r;break;case"v":i[1]=+c[1]-r;break;case"m":s=+c[1],o=+c[2];default:for(var h=1,u=c.length;h<u;h++)i[h]=+c[h]-(h%2?n:r)}else i=[],e[a]=i,"m"===c[0]&&(s=+c[1]+n,o=+c[2]+r),c.map((function(t){return e[a].push(t)}));var l=e[a].length;switch(e[a][0]){case"z":n=s,r=o;break;case"h":n+=e[a][l-1];break;case"v":r+=e[a][l-1];break;default:n+=e[a][l-2],r+=e[a][l-1]}},u=i;u<c;u++)h(u);return a(e,path.isClosed)}function m(t,e,a){return{x:t*Math.cos(a)-e*Math.sin(a),y:t*Math.sin(a)+e*Math.cos(a)}}function y(t,e,a,n,r,s,o,i,c,h){var u,l,p,f,x,g=120*Math.PI/180,d=Math.PI/180*(r||0),v=[];if(h)l=h[0],p=h[1],f=h[2],x=h[3];else{t=(u=m(t,e,-d)).x,e=u.y;var M=(t-(i=(u=m(i,c,-d)).x))/2,b=(e-(c=u.y))/2,C=M*M/(a*a)+b*b/(n*n);C>1&&(a*=C=Math.sqrt(C),n*=C);var A=a*a,k=n*n,V=(s==o?-1:1)*Math.sqrt(Math.abs((A*k-A*b*b-k*M*M)/(A*b*b+k*M*M)));f=V*a*b/n+(t+i)/2,x=V*-n*M/a+(e+c)/2,l=Math.asin((e-x)/n),p=Math.asin((c-x)/n),l=t<f?Math.PI-l:l,p=i<f?Math.PI-p:p,l<0&&(l=2*Math.PI+l),p<0&&(p=2*Math.PI+p),o&&l>p&&(l-=2*Math.PI),!o&&p>l&&(p-=2*Math.PI)}var P=p-l;if(Math.abs(P)>g){var q=p,w=i,S=c;p=l+g*(o&&p>l?1:-1),i=f+a*Math.cos(p),c=x+n*Math.sin(p),v=y(i,c,a,n,r,0,o,w,S,[p,q,f,x])}P=p-l;var U=Math.cos(l),I=Math.sin(l),L=Math.cos(p),R=Math.sin(p),T=Math.tan(P/4),j=4/3*a*T,Z=4/3*n*T,z=[t,e],F=[t+j*I,e-Z*U],H=[i+j*R,c-Z*L],O=[i,c];return F[0]=2*z[0]-F[0],F[1]=2*z[1]-F[1],h?[F,H,O].concat(v):(v=[F,H,O].concat(v).join().split(",")).map((function(t,e){return e%2?m(v[e-1],t,d).y:m(t,v[e+1],d).x}))}function v(t,e,a,n,r,s){return[1/3*t+2/3*a,1/3*e+2/3*n,1/3*r+2/3*a,1/3*s+2/3*n,r,s]}function M(t,e,a,n){return[t,e,a,n,a,n]}function b(t,e,a){var n,r;if(!t)return["C",e.x,e.y,e.x,e.y,e.x,e.y];switch(!(t[0]in{T:1,Q:1})&&(e.qx=e.qy=null),t[0]){case"M":e.X=t[1],e.Y=t[2];break;case"A":t=["C"].concat(y.apply(0,[e.x,e.y].concat(t.slice(1))));break;case"S":"C"==a||"S"==a?(n=2*e.x-e.bx,r=2*e.y-e.by):(n=e.x,r=e.y),t=["C",n,r].concat(t.slice(1));break;case"T":"Q"==a||"T"==a?(e.qx=2*e.x-e.qx,e.qy=2*e.y-e.qy):(e.qx=e.x,e.qy=e.y),t=["C"].concat(v(e.x,e.y,e.qx,e.qy,t[1],t[2]));break;case"Q":e.qx=t[1],e.qy=t[2],t=["C"].concat(v(e.x,e.y,t[1],t[2],t[3],t[4]));break;case"L":t=["C"].concat(M(e.x,e.y,t[1],t[2]));break;case"H":t=["C"].concat(M(e.x,e.y,t[1],e.y));break;case"V":t=["C"].concat(M(e.x,e.y,e.x,t[1]));break;case"Z":t=["C"].concat(M(e.x,e.y,e.X,e.Y))}return t}function C(t,e,a,n,r){t&&e&&"M"===t[r][0]&&"M"!==e[r][0]&&(e.splice(r,0,["M",n.x,n.y]),a.bx=0,a.by=0,a.x=t[r][1],a.y=t[r][2])}function A(t,e,a,n,r){if(t[r].length>7){t[r].shift();for(var s=t[r];s.length;)a[r]="A",e&&(n[r]="A"),t.splice(r++,0,["C"].concat(s.splice(0,6)));t.splice(r,1)}}function k(t,e){for(var n=g(t),r=e&&g(e),s={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},o={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},i=[],c=[],h="",u="",l=Math.max(n.length,r&&r.length||0),p=0;p<l;p++){n[p]&&(h=n[p][0]),"C"!==h&&(i[p]=h,p&&(u=i[p-1])),n[p]=b(n[p],s,u),"A"!==i[p]&&"C"===h&&(i[p]="C"),A(n,r,i,c,p),l=Math.max(n.length,r&&r.length||0),r&&(r[p]&&(h=r[p][0]),"C"!==h&&(c[p]=h,p&&(u=c[p-1])),r[p]=b(r[p],o,u),"A"!==c[p]&&"C"===h&&(c[p]="C"),A(r,n,c,i,p),l=Math.max(n.length,r&&r.length||0)),C(n,r,s,o,p),r&&C(r,n,o,s,p),l=Math.max(n.length,r&&r.length||0);var f=n[p],x=r&&r[p],d=f.length,m=r&&x.length;s.x=f[d-2],s.y=f[d-1],s.bx=parseFloat(f[d-4])||s.x,s.by=parseFloat(f[d-3])||s.y,o.bx=r&&(parseFloat(x[m-4])||o.x),o.by=r&&(parseFloat(x[m-3])||o.y),o.x=r&&x[m-2],o.y=r&&x[m-1]}return r?[a(n),a(r)]:a(n)}function V(t){return t.map((function(t){return"string"==typeof t?t:t.shift()+t.join(",")})).join(" ")}function P(e){var a,n,r,s,o,i,c=t(e),h=c.length-2,u=0,l=0,p=[],f=[],x=c.slice(1),g=x.map((function(t,e){return l=(u=h-e)-1<0?h:u-1,p=x[u],f=x[l],o=f[f.length-2],i=f[f.length-1],a=p[3],n=p[4],r=p[1],s=p[2],[t[0],a,n,r,s,o,i]}));return[["M",g[h][5],g[h][6]]].concat(g)}function q(t){var e,a,n,r,s,o,i,c=g(t).some((function(t){return"Z"===t[0].toUpperCase()})),h=P(k(t)),u=[];return h.map((function(t,c){switch(o=t[t.length-2],i=t[t.length-1],a=t[1],n=t[2],r=t[3],s=t[4],e=3===t.length?"M":r===o&&s===i?"L":n===s===i?"H":a===r===o?"V":t[0]){case"M":u=["M",o,i];break;case"L":u=[e,o,i];break;case"V":u=[e,i];break;case"H":u=[e,o];break;case"Z":u=[e];break;case"C":default:u=[e,a,n,r,s,o,i]}return u})).concat(c?[["Z"]]:[])}function w(t){return t.replace(/(m|M)/g,"|$1").split("|").map((function(t){return t.trim()})).filter((function(t){return t}))}var S=function(e){var a=p(e);return this.segments=t(a),this.pathValue=e,this};function U(t){var e=t[0],a=t[1],n=t[2],r=t[3],s=t[4],o=t[5],i=t[6],c=t[7];return 3*((c-a)*(n+s)-(i-e)*(r+o)+r*(e-s)-n*(a-o)+c*(s+e/3)-i*(o+a/3))/20}function I(t){var e=0;return t.map((function(a,n){var r=t[0===n?t.length-1:n-1];e+=U(r.slice(r.length-2).concat(a.slice(1)))})),e}S.prototype.toAbsolute=function(){var e=g(this.segments);return this.segments=t(e),this},S.prototype.toRelative=function(){var e=d(this.segments);return this.segments=t(e),this},S.prototype.reverse=function(e){var a=w(this.pathValue).length>1,n=a&&w(V(g(this.segments))).map((function(t,a){return e?a?q(t):p(t):q(t)})),r=a?[].concat.apply([],n):q(this.segments);return this.segments=t(r),this},S.prototype.optimize=function(){var e,a,n,r=(e=this.segments,a=g(e),n=d(e),a.map((function(t,e){return e?t.join("").length<n[e].join("").length?t:n[e]:t})));return this.segments=t(r),this},S.prototype.toString=function(){return V(this.segments)};var L={a2c:y,catmullRom2bezier:f,clonePath:t,ellipsePath:x,fixArc:A,fixM:C,getArea:U,getDrawDirection:function(t){if(Array.isArray(t)&&t.slice(1).every((function(t){return t[0].toUpperCase()===t[0]})))return I(t)>=0;throw"getDrawDirection expects a curveArray"},getShapeArea:I,l2c:M,q2c:v,rotateVector:m,splitPath:w,roundPath:a,pathToAbsolute:g,pathToRelative:d,pathToCurve:k,pathToString:V,parsePathString:p,processPath:b,reverseCurve:P,reversePath:q,options:e};for(var R in L)S[R]=L[R];return S}));
